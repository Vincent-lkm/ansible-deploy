---
- name: Kill brutal tous les processus update.sh sur Batch1 (10 serveurs)
  hosts: batch1
  gather_facts: no
  tasks:
    - name: "ğŸ’€ Kill brutal tous les processus update.sh"
      raw: |
        echo "ğŸ” Processus update.sh avant kill sur $(hostname):"
        ps aux | grep update.sh | grep -v grep || echo "Aucun processus update.sh actif"
        
        echo ""
        echo "ğŸ’€ Kill brutal de tous les update.sh..."
        pkill -9 -f "update.sh" 2>/dev/null && echo "âœ… Processus update.sh tuÃ©s sur $(hostname)" || echo "âš ï¸ Aucun processus update.sh Ã  tuer sur $(hostname)"
        
        echo ""
        echo "ğŸ” VÃ©rification aprÃ¨s kill:"
        ps aux | grep update.sh | grep -v grep || echo "âœ… Aucun processus update.sh restant sur $(hostname)"
        
        echo ""
        echo "ğŸ§¹ Nettoyage des fichiers de lock si existants..."
        find /mnt/www -name "*.lock" -type f 2>/dev/null | while read lockfile; do
          echo "ğŸ—‘ï¸ Suppression: $lockfile"
          rm -f "$lockfile"
        done || echo "Aucun fichier lock trouvÃ©"
        
        echo "âœ… Kill terminÃ© sur $(hostname)"
      register: kill_result
      
    - name: "ğŸ“Š RÃ©sultat du kill"
      debug:
        msg: "{{ kill_result.stdout_lines }}"
